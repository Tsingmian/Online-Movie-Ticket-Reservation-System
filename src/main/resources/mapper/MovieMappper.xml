<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.movie_ticket_reservation.mapper.MovieMapper">

    <!-- 普通用户：查询所有上映中电影 -->
    <select id="getAllMoviesAvailable" resultType="com.example.movie_ticket_reservation.entity.Movie">
        SELECT id, title, duration, director, actors, description, release_date AS releaseDate, status
        FROM movie
        WHERE status = 1
        ORDER BY release_date DESC
    </select>

    <!-- 管理端：查询所有电影（包括下架的） -->
    <select id="getAllMovies" resultType="com.example.movie_ticket_reservation.entity.Movie">
        SELECT id, title, duration, director, actors, description, release_date AS releaseDate, status
        FROM movie
        ORDER BY release_date DESC
    </select>

    <!-- 根据ID查询电影（管理端/普通用户共用） -->
    <select id="getMovieById" resultType="com.example.movie_ticket_reservation.entity.Movie">
        SELECT id, title, duration, director, actors, description, release_date AS releaseDate, status
        FROM movie
        WHERE id = #{id}
    </select>

    <!-- 模糊查询上映中电影（普通用户） -->
    <select id="searchMovies" resultType="com.example.movie_ticket_reservation.entity.Movie">
        SELECT id, title, duration, director, actors, description, release_date AS releaseDate, status
        FROM movie
        WHERE title LIKE CONCAT('%', #{keyword}, '%')
        <if test="keyword != null">
            AND status = 1
        </if>
        ORDER BY release_date DESC
    </select>

    <!-- 新增电影（管理端） -->
    <insert id="insertMovie" parameterType="com.example.movie_ticket_reservation.entity.Movie">
        INSERT INTO movie(title, duration, director, actors, description, release_date, status)
        VALUES (#{title}, #{duration}, #{director}, #{actors}, #{description}, #{releaseDate}, #{status})
    </insert>

    <!-- 更新电影（管理端） -->
    <update id="updateMovie" parameterType="com.example.movie_ticket_reservation.entity.Movie">
        UPDATE movie
        SET title = #{title},
        duration = #{duration},
        director = #{director},
        actors = #{actors},
        description = #{description},
        release_date = #{releaseDate},
        status = #{status}
        WHERE id = #{id}
    </update>

    <!-- 删除电影（管理端） -->
    <delete id="deleteMovie">
        DELETE FROM movie WHERE id = #{id}
    </delete>

    <select id="selectById" resultType="com.example.movie_ticket_reservation.entity.Movie">
        SELECT id, title, duration, director, actors, description, release_date AS releaseDate, status
        FROM movie
        WHERE id = #{id}
    </select>
</mapper>
